<%- include('partials/header', { title: title }) %>

  <section id="lapuserprofile">
    <div id="list">
      <div class="row-md-3">
        <div class="row ms-5  pt-3">
          <div class="card ">
            <h6><img style="margin-right: 1px;" class="ms-2 my-1" width="55" height="55"
                src="https://img.icons8.com/color/48/name--v1.png" alt="name--v1" />&nbsp;hello</h6>
            <h6 class="text-center ms-1" style="margin-top: -25px;">&nbsp;<%= Name %>
            </h6>
          </div>
        </div>
      </div>
      <div id="border" class="row ms-5  pt-5">
        <div class="card border-0">
          <h5><a id="text" href=""><img width="35" height="35"
                src="https://img.icons8.com/ios-filled/35/order-completed.png" alt="order-completed" />&nbsp;My
              Orders</a></h5>
        </div>
      </div>
      <div id="border" class="row ms-5  pt-3">
        <div class="card border-0">
          <h5><a id="text" href=""><img width="35" height="35"
                src="https://img.icons8.com/fluency-systems-filled/40/user.png" alt="user" />&nbsp;My Account</a></h5>
          <a id="text" class="text-end" href="/user-personal-information">Profile information</a>
          <a id="text" class="text-center ms-4" href="/address">Manage address</a>
          <br>
        </div>
      </div>
      <div class="row ms-5  pt-3 ">
        <div class="card border-0">
          <h5><a id="text" href=""><img width="30" height="30" src="https://img.icons8.com/ios-filled/35/topic.png"
                alt="topic" />&nbsp;My Stuff</a></h5>
          <a id="text" class="ms-5" href="/wishlist">wishlist</a>
        </div>
      </div>
      <div class="row ms-5  pt-2">
        <div class="card">
          <button class=" border-0 bg-white"><a id="text" href="/logout">logout</a></button>
        </div>
      </div>
    </div>
    </div>
    </div>
    </div>
    </div>
  </section>
  <section id="lapuserprofile">
    <style>
      .modal-body label {
        margin-right: 10px;
      }
        /* Adjust the margin value as needed */
        .spec-container {
          display: flex;
          margin-bottom: 10px;
          /* Adjust the value as needed for space between pairs */
          align-items: flex-start;
          /* Aligns items at the start of the flex container */
          flex-wrap: wrap;
          /* Allows wrapping for long text */
        }

        .spec-label {
          font-weight: 400;
          width: 220px;
          /* Adjust the width as needed */
          white-space: nowrap;
          /* Prevents the label from wrapping */
        }

        .spec-value {
          flex: 1;
          /* Takes the remaining space */
          overflow-wrap: break-word;
          /* Ensures long words break properly */
          max-width: calc(100% - 270px);
          /* Ensures value stays in line, adjust based on label width */
        }
    </style>
    <div id="userprodile">
      <div class="table-responsive p-5">
        <h5>My Order</h5>
        <% if (payments.length> 0) { %>
          <table class="table table-striped table-bordered" id="table">
            <thead>
              <tr class="table-dark" style="background-color: gray;">
                <th>ID</th>
                <th>Date&time</th>
                <th>Model</th>
                <th>Color</th>
                <th>Price</th>
                <th>Payment Method</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <% payments.forEach((payment, index)=> { %>
                <tr>
                  <td>
                    <%= (currentPage - 1) * 3 + index + 1 %>
                  </td>
                  <td>
                    <%= payment.date %> <br>
                      <%= payment.time %>
                  </td>
                  <td id="userordertext">
                    <%= payment.model %>
                  </td>
                  <td>
                    <%= payment.Color %>
                  </td>
                  <td>
                    <%= payment.price %>
                  </td>
                  <td>
                    <%= payment.paymentMethod %>
                  </td>
                  <td>
                    <a href="<%= payment._id %>" 
                       style="font-size:x-small;text-decoration: none;" 
                       data-bs-toggle="modal"
                       data-bs-target="#staticBackdrop-<%= payment._id %>">View details</a>
                  </td>
                                    
                  <!-- Modal -->
                  <div class="modal fade" 
                       id="staticBackdrop-<%= payment._id %>" 
                       data-bs-backdrop="static" 
                       data-bs-keyboard="false"
                       tabindex="-1" 
                       aria-labelledby="staticBackdropLabel-<%= payment._id %>" 
                       aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h1 class="modal-title fs-5" id="staticBackdropLabel-<%= payment._id %>">Receipt</h1>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <div class="spec-container">
                            <label class="spec-label">Time</label>
                            <span class="spec-value">
                              <%= payment.time %>
                            </span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Date</label>
                            <span class="spec-value"><%= payment.date %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Name</label>
                            <span class="spec-value"><%= payment.fullname %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Item</label>
                            <span class="spec-value"><%= payment.model %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Color</label>
                            <span class="spec-value"><%= payment.Color %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Quantity</label>
                            <span class="spec-value"><%= payment.quantity %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Delivery address</label>
                            <span class="spec-value">
                              <%= payment.address %>
                              <%= payment.city %>
                              <%= payment.state %>
                            </span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Payment Method</label>
                            <span class="spec-value"><%= payment.paymentMethod %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Order ID</label>
                            <span class="spec-value">#<%= payment._id %></span>
                          </div>
                          <div class="spec-container">
                            <label class="spec-label">Price</label>
                            <span class="spec-value"><%= payment.price %>/-</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                </tr>
                <% }); %>
            </tbody>
          </table>

          <!-- Pagination Controls -->
          <nav aria-label="Page navigation example">
            <ul class="pagination">
              <% if (currentPage> 1) { %>
                <li class="page-item">
                  <a class="page-link" href="?page=<%= parseInt(currentPage) - 1 %>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                <% } %>
                  <% for (let i=1; i <=totalPages; i++) { %>
                    <li class="page-item <%= currentPage == i ? 'active' : '' %>">
                      <a class="page-link" href="?page=<%= i %>">
                        <%= i %>
                      </a>
                    </li>
                    <% } %>
                      <% if (currentPage < totalPages) { %>
                        <li class="page-item">
                          <a class="page-link" href="?page=<%= parseInt(currentPage) + 1 %>" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                          </a>
                        </li>
                        <% } %>
            </ul>
          </nav>
          <% } else { %>
            <p style="margin-left: 190px; margin-top: 120px;">No checkout details available.</p>
            <% } %>
      </div>
    </div>
  </section>



  <section id="mobileuserprofile">
    <!-- Button to trigger offcanvas -->
    <nav class="d-flex justify-content-between align-items-center" style="--bs-breadcrumb-divider: '<';" aria-label="breadcrumb">
      <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
        <img width="30" height="30" src="https://img.icons8.com/material-sharp/50/menu.png" alt="menu" />
      </button>
    
      <ol class="breadcrumb mb-0 ms-5">
        <li class="breadcrumb-item "><a class="text-decoration-none" href="/home">Home</a></li>
        <li class="breadcrumb-item active " aria-current="page">MY Order</li>
      </ol>
    </nav>
    
    <!-- Offcanvas component -->
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
      aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">My Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <!-- Existing content -->
        <section>
          <div id="list" class="container">
            <div class="row pt-3">
              <div class="col-md-3 col-12">
                <div class="card ">
                  <h6>
                    <img class="my-1 ms-3" width="40" height="40" src="https://img.icons8.com/color/48/name--v1.png"
                      alt="name--v1" />
                    &nbsp;hello,   <%= Name %>
                  </h6>
                </div>
              </div>
            </div>
            <div class="row pt-5">
              <div class="col-12">
                <div class="card border-0">
                  <h5>
                    <a style="text-decoration: none; color: gray;"  href="/user-profile">
                      <img width="35" height="35" src="https://img.icons8.com/ios-filled/35/order-completed.png"
                        alt="order-completed" />
                      &nbsp;My Orders
                    </a>
                  </h5>
                </div>
              </div>
            </div>
            <div class="row pt-3">
              <div class="col-12">
                <div class="card border-0">
                  <h5>
                    <a style="text-decoration: none;color: black;" href="">
                      <img width="35" height="35" src="https://img.icons8.com/fluency-systems-filled/40/user.png"
                        alt="user" />
                      &nbsp;My Account
                    </a>
                  </h5>
                  <a style="text-decoration: none; color: gray; margin-right: 100px;font-size: medium;" class="text-center d-block" href="/user-personal-information">Profile information</a>
                  <a style="text-decoration: none; color: gray; margin-right: 100px;font-size: medium;" class="text-center d-block" href="/address">Manage address</a>
                </div>
              </div>
            </div>
            <div class="row pt-3">
              <div class="col-12">
                <div class="card border-0">
                  <h5>
                    <a style="text-decoration: none;color: black;" href="">
                      <img width="30" height="30" src="https://img.icons8.com/ios-filled/35/topic.png" alt="topic" />
                      &nbsp;My Stuff
                    </a>
                  </h5>
                  <a style="text-decoration: none; color: gray; margin-right: 100px;font-size: medium;" class="ms-5 d-block" href="/wishlist">wishlist</a>
                </div>
              </div>
            </div>
            <div class="row pt-2">
              <div class="col-12">
                <div class="card">
                  <button class="btn border-0 bg-white w-100">
                    <a style="text-decoration: none;color: red;" href="/logout">logout</a>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

  </section>
  
  <section id="mobileuserprofile">
    <div id="userprodile" class="container">
      <div class="table-responsive p-3">
        <h5>My Order</h5>
        <% if (payments.length> 0) { %>
          <table class="table table-striped table-bordered" id="table">
            <thead>
              <tr class="table-dark">
                <th>ID</th>
                <th>Date & Time</th>
                <th>Model</th>
                <th>Color</th>
                <th>Price</th>
                <th>Payment Method</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <% payments.forEach((payment, index)=> { %>
                <tr>
                  <td>
                    <%= (currentPage - 1) * 3 + index + 1 %>
                  </td>
                  <td>
                    <%= payment.date %> <br>
                      <%= payment.time %>
                  </td>
                  <td id="userordertext">
                    <%= payment.model %>
                  </td>
                  <td>
                    <%= payment.Color %>
                  </td>
                  <td>
                    <%= payment.price %>
                  </td>
                  <td>
                    <%= payment.paymentMethod %>
                  </td>
                  <td>
                      <button type="button" class="btn btn-primary" 
                              data-bs-toggle="modal" 
                              data-bs-target="#staticBackdrop"
                              data-time="<%= payment.time %>"
                              data-date="<%= payment.date %>"
                              data-name="<%= payment.fullname %>"
                              data-item="<%= payment.model %>"
                              data-color="<%= payment.Color %>"
                              data-quantity="<%= payment.quantity %>"
                              data-address="<%= payment.address %>, <%= payment.city %>, <%= payment.state %>"
                              data-payment-method="<%= payment.paymentMethod %>"
                              data-order-id="<%= payment._id %>"
                              data-price="<%= payment.price %>/-">
                        details
                      </button>
                    </td>
                    <style>
                      .modal-body label {
                        margin-right: 10px;
                      }
                        /* Adjust the margin value as needed */
                        .spec-container {
                          display: flex;
                          margin-bottom: 10px;
                          /* Adjust the value as needed for space between pairs */
                          align-items: flex-start;
                          /* Aligns items at the start of the flex container */
                          flex-wrap: wrap;
                          /* Allows wrapping for long text */
                        }
                
                        #spec-label {
                          font-weight:100;
                          width: 220px;
                          /* Adjust the width as needed */
                          white-space: nowrap;
                          /* Prevents the label from wrapping */
                        }
                
                        #spec-value {
                          flex: 1;
                          margin-left: -70px;
                          /* Takes the remaining space */
                          overflow-wrap:anywhere;
                          /* Ensures long words break properly */
                          max-width: calc(100% - 100px);
                          font-size:xx-small;
                          /* Ensures value stays in line, adjust based on label width */
                        }
                     </style>
                  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <div class="spec-container" id="spec-container">
                            <label class="spec-label" id="spec-label">Time</label>
                            <span class="spec-value" id="spec-value"><%= payment.time %></span>
                        </div>
                        <div class="spec-container"id="spec-container">
                          <label class="spec-label" id="spec-label">Date</label>
                          <span class="spec-value" id="spec-value"><%= payment.date %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Name</label>
                          <span class="spec-value" id="spec-value"><%= payment.fullname %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Item</label>
                          <span class="spec-value" id="spec-value"><%= payment.model %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Color</label>
                          <span class="spec-value" id="spec-value"><%= payment.Color %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Quantity</label>
                          <span class="spec-value" id="spec-value"><%= payment.quantity %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Delivery address</label>
                          <span class="spec-value" id="spec-value">
                            <%= payment.address %>, <%= payment.city %>, <%= payment.state %>
                          </span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Payment Method</label>
                          <span class="spec-value" id="spec-value"><%= payment.paymentMethod %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Order ID</label>
                          <span class="spec-value" id="spec-value">#<%= payment._id %></span>
                        </div>
                        <div class="spec-container" id="spec-container">
                          <label class="spec-label" id="spec-label">Price</label>
                          <span class="spec-value" id="spec-value"><%= payment.price %>/-</span>
                        </div>
                      </div>
                    </div>
                  </div>                  
                </tr>
                <% }); %>
            </tbody>
          </table>

          <!-- Pagination Controls -->
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
              <% if (currentPage> 1) { %>
                <li class="page-item">
                  <a class="page-link" href="?page=<%= parseInt(currentPage) - 1 %>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                <% } %>
                  <% for (let i=1; i <=totalPages; i++) { %>
                    <li class="page-item <%= currentPage == i ? 'active' : '' %>">
                      <a class="page-link" href="?page=<%= i %>">
                        <%= i %>
                      </a>
                    </li>
                    <% } %>
                      <% if (currentPage < totalPages) { %>
                        <li class="page-item">
                          <a class="page-link" href="?page=<%= parseInt(currentPage) + 1 %>" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                          </a>
                        </li>
                        <% } %>
            </ul>
          </nav>
          <% } else { %>
            <p style="margin-left: 190px; margin-top: 120px;">No checkout details available.</p>
            <% } %>
      </div>
    </div>
  </section>

  <script>
    $(document).ready(function () {
      $("table").DataTable({
        order: [[0, 'desc']]
      });
    });
  </script>
  <%- include('partials/footer') %>


    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var truncateElements = document.querySelectorAll('#userordertext');
        truncateElements.forEach(function (element) {
          var fullText = element.textContent.trim();
          var truncatedText = fullText.split(' ').slice(0, 1).join(' ') + '...';
          element.textContent = truncatedText;
        });
      });
    </script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('staticBackdrop');

    modal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget; // Button that triggered the modal
      
      // Extract data attributes from the button
      var time = button.getAttribute('data-time');
      var date = button.getAttribute('data-date');
      var name = button.getAttribute('data-name');
      var item = button.getAttribute('data-item');
      var color = button.getAttribute('data-color');
      var quantity = button.getAttribute('data-quantity');
      var address = button.getAttribute('data-address');
      var paymentMethod = button.getAttribute('data-payment-method');
      var orderId = button.getAttribute('data-order-id');
      var price = button.getAttribute('data-price');

      // Update the modal's content
      modal.querySelector('.spec-container .spec-value:nth-of-type(1)').textContent = time;
      modal.querySelector('.spec-container .spec-value:nth-of-type(2)').textContent = date;
      modal.querySelector('.spec-container .spec-value:nth-of-type(3)').textContent = name;
      modal.querySelector('.spec-container .spec-value:nth-of-type(4)').textContent = item;
      modal.querySelector('.spec-container .spec-value:nth-of-type(5)').textContent = color;
      modal.querySelector('.spec-container .spec-value:nth-of-type(6)').textContent = quantity;
      modal.querySelector('.spec-container .spec-value:nth-of-type(7)').textContent = address;
      modal.querySelector('.spec-container .spec-value:nth-of-type(8)').textContent = paymentMethod;
      modal.querySelector('.spec-container .spec-value:nth-of-type(9)').textContent = orderId;
      modal.querySelector('.spec-container .spec-value:nth-of-type(10)').textContent = price;
    });
  });
</script>
